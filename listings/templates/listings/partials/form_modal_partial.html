<script>
  document.getElementById('appModalTitle').textContent = "{{ title|escapejs }}";
</script>

<form method="post"
      action="{{ post_url }}"
      hx-post="{{ post_url }}"
      enctype="multipart/form-data"
      hx-encoding="multipart/form-data"
      hx-target="#main-content"
      hx-swap="innerHTML">



  {% csrf_token %}

  {% if form.non_field_errors %}
    <div class="alert alert-danger">{{ form.non_field_errors }}</div>
  {% endif %}

  <div class="row g-3">

    {% for field in form.visible_fields %}

    {% if field.name == "id_image" %}
      <div class="col-md-6">
        <label class="form-label">{{ field.label }}</label>
  
        {% if form.instance.id_image %}
          <div class="d-flex align-items-center gap-2 mb-2">
            <a href="{{ form.instance.id_image.url }}" target="_blank" class="text-decoration-none">
              <img src="{{ form.instance.id_image.url }}"
                   alt="هوية"
                   style="height:44px;width:44px;object-fit:cover;border-radius:8px;border:1px solid #ddd;">
            </a>
  
            <div class="form-check m-0">
              {{ form.remove_id_image }}
              <label class="form-check-label" for="{{ form.remove_id_image.id_for_label }}">
                حذف
              </label>
            </div>
          </div>
        {% endif %}
  
        {{ field }}
  
        {% if field.errors %}
          <div class="text-danger small mt-1">{{ field.errors|striptags }}</div>
        {% endif %}
      </div>
  
    {% elif field.name == "remove_id_image" %}
      {# نخفيه من اللوب لأنه عرضناه فوق مع الصورة #}
  
    {% else %}
      <div class="{% if field.name == 'notes' %}col-12{% else %}col-md-6{% endif %}">
        <label class="form-label">{{ field.label }}</label>
        {{ field }}
        {% if field.errors %}
          <div class="text-danger small mt-1">{{ field.errors|striptags }}</div>
        {% endif %}
      </div>
    {% endif %}
  
  {% endfor %}
  

  </div>

  <div class="d-flex justify-content-end gap-2 mt-4">
    <button class="btn btn-primary" type="submit">حفظ</button>
    <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">إلغاء</button>
  </div>
</form>

<script>
  // add bootstrap classes to inputs (minimal)
  document.querySelectorAll("#appModalBody input, #appModalBody select, #appModalBody textarea").forEach(el=>{
    el.classList.add("form-control");
    if (el.tagName.toLowerCase() === "select") el.classList.add("form-select");
  });
</script>
