<!-- listings/partials/apartment_list_partial.html -->


<style>
  .filter-chip {
    border-radius: 999px;
    padding: .35rem .8rem;
    border: 1px solid rgba(0, 0, 0, .08);
    background: #fff;
  }

  .filter-chip.active {
    background: rgba(13, 110, 253, .12);
    /* primary soft */
    border-color: rgba(13, 110, 253, .25);
    color: #0d6efd;
    font-weight: 600;
  }
</style>


<div id="apartmentsWrapper">

  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 class="mb-0">الشقق</h3>

    <button class="btn btn-primary" type="button" hx-get="{% url 'apartment_create' %}" hx-target="#appModalBody">
      إضافة شقة جديدة
    </button>
  </div>

  <!-- فلترة الحالة -->
  <div class="d-flex gap-2 mb-3 flex-wrap">
    <button class="filter-chip {% if not current_status %}active{% endif %}" hx-get="{% url 'apartment_list' %}"
      hx-target="#apartmentsWrapper" hx-swap="outerHTML">
      الكل
    </button>

    <button class="filter-chip {% if current_status == 'VACANT' %}active{% endif %}"
      hx-get="{% url 'apartment_list' %}?status=VACANT" hx-target="#apartmentsWrapper" hx-swap="outerHTML">
      شاغرة فقط
    </button>

    <button class="filter-chip {% if current_status == 'RENTED' %}active{% endif %}"
      hx-get="{% url 'apartment_list' %}?status=RENTED" hx-target="#apartmentsWrapper" hx-swap="outerHTML">
      مؤجرة فقط
    </button>
  </div>




  <div class="card">
    <div class="table-responsive">
      <table class="table table-hover mb-0">

        <thead class="table-light">
          <tr>
            <th>المبنى</th>
            <th>رقم الشقة</th>
            <th>حالة الشقة</th>
            <th>الإيجار الشهري</th>
            <th class="text-end">الإجراءات</th>
          </tr>
        </thead>

        <tbody>
          {% for a in apartments %}
          <tr>
            <td>{{ a.building.name }}</td>
            <td>{{ a.apartment_no }}</td>

            <td>
              <span class="badge status-badge
                  {% if a.status == 'RENTED' %}bg-danger
                  {% elif a.status == 'VACANT' %}bg-success
                  {% else %}bg-warning text-dark
                  {% endif %}" role="button" style="cursor:pointer;" data-apartment-id="{{ a.id }}"
                data-current-status="{{ a.status }}" data-current-display="{{ a.get_status_display }}"
                onclick="openToggleStatusModal(this)" title="اضغط لتغيير الحالة">
                {{ a.get_status_display }}
              </span>
            </td>

            <td>{{ a.rent_amount }}</td>

            <td class="text-end">
              <a class="btn btn-sm btn-outline-primary" hx-get="{% url 'apartment_edit' a.id %}"
                hx-target="#appModalBody">تعديل</a>

              <a class="btn btn-sm btn-outline-danger" hx-get="{% url 'apartment_delete' a.id %}"
                hx-target="#appModalBody">حذف</a>
            </td>
          </tr>

          {% empty %}
          <tr>
            <td colspan="5" class="text-center text-muted p-4">
              لا توجد شقق مطابقة للفلترة.
            </td>
          </tr>
          {% endfor %}

        </tbody>

      </table>
    </div>
  </div>

</div>