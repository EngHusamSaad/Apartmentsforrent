
<!-- DASHBOARD_CONTENT_OK -->

<div class="d-flex align-items-center justify-content-between mb-3">
  <h3 class="mb-0">نظام ادارة العقارات و المستأجرين</h3>
</div>

<div class="row g-3">
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">عدد المباني</div>
      <div class="fs-3 fw-bold">{{ stats.buildings }}</div>
    </div></div>
  </div>

  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">عدد الشقق</div>
      <div class="fs-3 fw-bold">{{ stats.apartments }}</div>
    </div></div>
  </div>

  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">الشقق الفارغة</div>
      <div class="fs-3 fw-bold">{{ stats.vacant }}</div>
    </div></div>
  </div>

  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">عقود الاجار</div>
      <div class="fs-3 fw-bold">{{ stats.active_leases }}</div>
    </div></div>
  </div>

  <div class="col-md-3">
    <div class="card border-warning"><div class="card-body">
      <div class="text-muted">تنتهي خلال {{ soon_days }} يوم</div>
      <div class="fs-3 fw-bold">{{ stats.expiring_soon }}</div>
      <div class="small mt-2">
        <a href="{% url 'lease_list' %}" class="text-decoration-none">عرض العقود</a>
      </div>
    </div></div>
  </div>
</div>

<hr class="my-4">

{# ===== تنبيه استحقاق الأجرة الشهرية ===== #}
{% if show_rent_notice %}
  <div class="alert alert-info d-flex align-items-start justify-content-between gap-3 mb-4">
    <div>
      <div class="fw-bold">تنبيه: استحقاق الأجرة للشهر القادم</div>
      <div class="text-muted small">
        تاريخ الاستحقاق: {{ next_month_start }}
      </div>
    </div>

    <div class="text-end">
      <div class="small text-muted">إجمالي متوقع</div>
      <div class="fs-5 fw-bold">{{ rent_due_total }}</div>
    </div>
  </div>

  {% if rent_due_leases %}
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h6 class="mb-0">تفاصيل الاستحقاق (أول 10)</h6>
          <a class="btn btn-sm btn-outline-primary" href="{% url 'lease_list' %}">عرض كل العقود</a>
        </div>

        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>المستأجر</th>
                <th>العمارة</th>
                <th>الشقة</th>
                <th class="text-end">الأجرة</th>
              </tr>
            </thead>
            <tbody>
              {% for l in rent_due_leases %}
                <tr>
                  <td>{{ l.tenant.full_name }}</td>
                  <td>{{ l.apartment.building.name }}</td>
                  <td>{{ l.apartment.apartment_no }}</td>
                  <td class="text-end fw-semibold">{{ l.rent_amount }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>
  {% endif %}
{% endif %}

<div class="card shadow-sm">
  <div class="card-body">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h5 class="mb-0">عقود قاربت على الانتهاء (خلال {{ soon_days }} يوم)</h5>
      <a class="btn btn-sm btn-outline-primary" href="{% url 'lease_list' %}">عرض كل العقود</a>
    </div>

    {% if expiring_leases %}
      <div class="table-responsive">
        <table class="table table-sm align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>المستأجر</th>
              <th>العمارة</th>
              <th>الشقة</th>
              <th>تاريخ الانتهاء</th>
              <th class="text-end">متبقي</th>
            </tr>
          </thead>
          <tbody>
            {% for l in expiring_leases %}
              <tr class="{% if l.end_date <= danger_until %}table-danger{% elif l.end_date <= warning_until %}table-warning{% endif %}">
                <td>{{ l.tenant.full_name }}</td>
                <td>{{ l.apartment.building.name }}</td>
                <td>{{ l.apartment.apartment_no }}</td>
                <td class="fw-semibold">{{ l.end_date }}</td>
                <td class="text-end">{{ l.end_date|timeuntil }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="d-flex gap-3 mt-3 small text-muted">
        <div><span class="badge bg-danger"> </span> خلال 7 أيام</div>
        <div><span class="badge bg-warning text-dark"> </span> خلال 14 يوم</div>
      </div>
    {% else %}
      <div class="text-muted">لا يوجد عقود ستنتهي قريبًا.</div>
    {% endif %}
  </div>
</div>
