<!-- listings/partials/lease_list_partial.html -->

<div id="leasesWrapper">

  <!-- ุงูุนููุงู + ุฒุฑ ุงูุฅุถุงูุฉ -->
  <div class="d-flex align-items-center justify-content-between mb-2">
    <h3 class="mb-0">ุนููุฏ ุงูุฅูุฌุงุฑ</h3>

    <a class="btn btn-primary"
       href="{% url 'lease_create' %}"
       hx-get="{% url 'lease_create' %}"
       hx-target="#appModalBody">
      ุงุถุงูุฉ ุนูุฏ ุงุฌุงุฑ ุฌุฏูุฏ
    </a>
  </div>

  <!-- โ ุดุฑูุท ููุชุฑุฉ + ุจุญุซ -->
  <form class="card mb-3 shadow-sm"
  hx-get="{% url 'lease_list' %}"
  hx-target="#leasesWrapper"
  hx-swap="outerHTML"
  hx-trigger="submit, keyup changed delay:400ms from:input[name='q']">

    <div class="card-body py-3">
      <div class="row g-2 align-items-end">

        <!-- ููุชุฑุฉ ุญุณุจ ุงููุณุชุฃุฌุฑ -->
        <div class="col-12 col-md-4">
          <label class="form-label mb-1 small text-muted">ููุชุฑุฉ ุญุณุจ ุงููุณุชุฃุฌุฑ</label>
          <select class="form-select form-select-sm"
                  name="tenant"
                  hx-trigger="change">
            <option value="" {% if not current_tenant %}selected{% endif %}>ูู ุงููุณุชุฃุฌุฑูู</option>
            {% for t in tenants %}
              <option value="{{ t.id }}" {% if current_tenant == t.id|stringformat:"s" %}selected{% endif %}>
                {{ t.full_name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- ุจุญุซ ุจุงุณู ุงููุณุชุฃุฌุฑ -->
        <div class="col-12 col-md-5">
          <label class="form-label mb-1 small text-muted">ุจุญุซ ุจุงุณู ุงููุณุชุฃุฌุฑ</label>
          <input type="search"
          class="form-control form-control-sm"
          name="q"
          value="{{ q|default:'' }}"
          placeholder="ุงูุชุจ ุงุณู ุงููุณุชุฃุฌุฑ...">
        </div>

        <!-- ุฃุฒุฑุงุฑ -->
        <div class="col-12 col-md-3 d-flex gap-2">
          <button class="btn btn-primary btn-sm flex-grow-1" type="submit">
            ุจุญุซ
          </button>

          <button class="btn btn-outline-secondary btn-sm"
                  type="button"
                  hx-get="{% url 'lease_list' %}"
                  hx-target="#leasesWrapper"
                  hx-swap="outerHTML">
            ูุณุญ
          </button>
        </div>

      </div>

      {% if current_tenant or q %}
      <div class="mt-2 small text-muted">
        ูุชุงุฆุฌ ูููุชุฑุฉ
        {% if current_tenant %} โข ูุณุชุฃุฌุฑ ูุญุฏุฏ{% endif %}
        {% if q %} โข ุจุญุซ: โ{{ q }}โ{% endif %}
      </div>
      {% endif %}
    </div>
  </form>

  <!-- โ ุงูุฌุฏูู ูุงูู -->
  <div class="card">
    <div class="table-responsive">
      <table class="table table-hover table-sm mb-0 text-center align-middle">
        <thead class="table-light align-middle">
          <tr>
            <th>#</th>  <!-- ๐ ุนููุฏ ุงูุชุฑููู -->
            <th>ุงูุดูุฉ ุงููุณุชุฃุฌุฑุฉ</th>
            <th>ุงููุณุชุฃุฌุฑ</th>
            <th>ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุนูุฏ</th>
            <th>ุชุงุฑูุฎ ููุงูุฉ ุงูุนูุฏ</th>
            <th>ุงูุงุฌุงุฑ ุงูุดูุฑู</th>
            <th>ุญุงูุฉ ุงูุนูุฏ</th>
            <th class="text-end">ุงูุงุฌุฑุงุกุงุช</th>
          </tr>
        </thead>

        <tbody>
          {% for l in leases %}
          <tr class="{% if l.status == 'EXPIRED' %}table-danger{% endif %}">
            <td>{{ forloop.counter }}</td>  <!-- ๐ ุงูุชุนุฏุงุฏ -->

            <td>{{ l.apartment }}</td>
            <td>
              <button type="button"
                      class="btn btn-link p-0 text-decoration-none tenant-link"
                      data-bs-toggle="modal"
                      data-bs-target="#tenantModal"
                      hx-get="{% url 'tenant_quick_view' l.tenant.id %}"
                      hx-target="#tenantModalBody"
                      hx-swap="innerHTML">
                {{ l.tenant }}
              </button>
            </td>
            
            <td>{{ l.start_date }}</td>
            <td>{{ l.end_date|default:"-" }}</td>
            <td>{{ l.rent_amount }}</td>
            <td>
              <button type="button"
                      class="btn btn-link p-0 text-decoration-none"
                      hx-get="{% url 'lease_toggle_status' l.id %}?tenant={{ current_tenant|urlencode }}&q={{ q|urlencode }}"
                      hx-target="#appModalBody"
                      hx-swap="innerHTML">
                {% if l.status == 'ACTIVE' %}
                  <span class="badge text-bg-success">ูุดุท</span>
                {% elif l.status == 'EXPIRED' %}
                  <span class="badge text-bg-danger">ููุชูู</span>
                {% else %}
                  <span class="badge text-bg-secondary">{{ l.get_status_display }}</span>
                {% endif %}
              </button>
            </td>
            <td class="text-end">
              <a class="btn btn-sm btn-outline-secondary"
                 href="{% url 'lease_contract_preview' l.id %}"
                 target="_blank" rel="noopener">
                ุนูุฏ PDF
              </a>

              <a class="btn btn-sm btn-outline-primary"
                 href="{% url 'lease_edit' l.id %}"
                 hx-get="{% url 'lease_edit' l.id %}"
                 hx-target="#appModalBody">
                ุชุนุฏูู
              </a>

              <a class="btn btn-sm btn-outline-danger"
                 href="{% url 'lease_delete' l.id %}"
                 hx-get="{% url 'lease_delete' l.id %}"
                 hx-target="#appModalBody">
                ุญุฐู
              </a>
            </td>
          </tr>

          {% empty %}
          <tr>
            <td colspan="8" class="text-center text-muted p-4">
              ูุง ุชูุฌุฏ ุนููุฏ ุฅูุฌุงุฑ ูุทุงุจูุฉ ููููุชุฑ.
            </td>
          </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>
  </div>
<!-- Tenant Quick View Modal -->



  

</div>
