<script>
  document.getElementById('appModalTitle').textContent = "{{ title|escapejs }}";
</script>

{% if lease.status == 'ACTIVE' %}
  <form method="post"
        hx-post="{% url 'lease_toggle_status' lease.id %}"
        hx-target="#leasesWrapper"
        hx-swap="outerHTML">
    {% csrf_token %}

    <p class="mb-2 text-muted small">
      سيتم تحويل حالة العقد إلى <strong>منتهي</strong> عند الحفظ.
    </p>

    <div class="mb-3">
      <label class="form-label">{{ form.end_date.label }}</label>
      {{ form.end_date }}
      {% if form.end_date.errors %}
        <div class="text-danger small mt-1">{{ form.end_date.errors|striptags }}</div>
      {% endif %}
    </div>

    <input type="hidden" name="tenant" value="{{ tenant }}">
    <input type="hidden" name="q" value="{{ q }}">

    <div class="d-flex justify-content-end gap-2 mt-4">
      <button class="btn btn-danger" type="submit">إنهاء العقد</button>
      <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">إلغاء</button>
    </div>
  </form>
{% else %}
  <form method="post"
        hx-post="{% url 'lease_toggle_status' lease.id %}"
        hx-target="#leasesWrapper"
        hx-swap="outerHTML">
    {% csrf_token %}

    <div class="alert alert-warning mb-3">
      هل تريد <strong>إرجاع العقد لنشط</strong>؟
      <div class="small mt-1 text-muted">سيتم مسح تاريخ النهاية (end_date).</div>
    </div>

    <input type="hidden" name="tenant" value="{{ tenant }}">
    <input type="hidden" name="q" value="{{ q }}">

    <div class="d-flex justify-content-end gap-2 mt-4">
      <button class="btn btn-success" type="submit">إرجاع لنشط</button>
      <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">إلغاء</button>
    </div>
  </form>
{% endif %}

